// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Admin {
  id       String @id @default(auto()) @map("_id") @db.ObjectId
  username String @unique
  password String
  name     String
}

model Question {
  id       String @id @default(auto()) @map("_id") @db.ObjectId
  question String
  options  Json
  answer   String
  category String // Output, Programming, DBMS, OS, OOPS, Networks, DataStructures, TimeComplexity, Algorithms, ComputerBasics
}

model Team {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  teamname  String   @unique
  members   Member[]
  answers   Answer[]

  // exam state
  startTime BigInt?
  endTime   BigInt?
  quizscore Int      @default(0)
  strikes   Int      @default(0)
  disqualified Boolean @default(false)

  questions Json? // [qid, qid, ...]
}

model Member {
  id         String @id @default(auto()) @map("_id") @db.ObjectId
  name       String
  mobileno   String
  regno      String
  department String
  course     String
  branch     String
  teamId     String @db.ObjectId
  Team       Team   @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@index([teamId])
}

model Answer {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  teamId String @db.ObjectId
  qid    String @db.ObjectId
  answer String

  Team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([teamId, qid])
  @@index([teamId])
}
